<div
  class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6"
  *ngIf="stats$ | async as stats"
>
  <!-- Total Orders -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-primary/5 rounded-lg text-primary">
        <lucide-icon [img]="icons.Receipt" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-gray-500 bg-gray-100 px-2 py-1 rounded-full"
        >All time</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Total Orders</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.totalOrders }}
      </h3>
    </div>
  </div>

  <!-- Daily Traffic -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
    *ngIf="dailyTraffic$ | async as traffic"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-pink-50 rounded-lg text-pink-600">
        <lucide-icon [img]="icons.Eye" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-pink-600 bg-pink-50 px-2 py-1 rounded-full"
        >Today</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Daily Visitors</p>
      <div class="flex items-baseline gap-2">
        <h3 class="text-2xl font-bold text-primary tracking-tight">
          {{ traffic.uniqueVisitors }}
        </h3>
        <span class="text-xs text-gray-500 font-medium"
          >({{ traffic.pageViews }} views)</span
        >
      </div>
    </div>
  </div>

  <!-- Total Revenue -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-emerald-50 rounded-lg text-emerald-600">
        <lucide-icon [img]="icons.CreditCard" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full"
        >Revenue</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Total Revenue</p>
      <app-price-display
        class="text-primary"
        [amount]="stats.totalRevenue"
        size="lg"
      ></app-price-display>
    </div>
  </div>

  <!-- Delivered -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-blue-50 rounded-lg text-blue-600">
        <lucide-icon [img]="icons.Truck" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full"
        >Delivered</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Orders Delivered</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.deliveredOrders }}
      </h3>
    </div>
  </div>

  <!-- Pending -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-amber-50 rounded-lg text-amber-600">
        <lucide-icon [img]="icons.Clock" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-amber-600 bg-amber-50 px-2 py-1 rounded-full"
        >Pending</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Pending Orders</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.pendingOrders }}
      </h3>
    </div>
  </div>

  <!-- Total Products -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-indigo-50 rounded-lg text-indigo-600">
        <lucide-icon [img]="icons.Package" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-full"
        >Catalog</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Total Products</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.totalProducts }}
      </h3>
    </div>
  </div>

  <!-- Total Customers -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-purple-50 rounded-lg text-purple-600">
        <lucide-icon [img]="icons.Users" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-purple-600 bg-purple-50 px-2 py-1 rounded-full"
        >Users</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Total Customers</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.totalCustomers }}
      </h3>
    </div>
  </div>

  <!-- Return Rate -->
  <div
    class="bg-surface p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow"
  >
    <div class="flex items-start justify-between">
      <div class="p-3 bg-rose-50 rounded-lg text-rose-600">
        <lucide-icon [img]="icons.RotateCcw" class="w-6 h-6"></lucide-icon>
      </div>
      <span
        class="text-xs font-semibold text-rose-600 bg-rose-50 px-2 py-1 rounded-full"
        >Return Rate</span
      >
    </div>
    <div>
      <p class="text-gray-500 text-sm font-medium mb-1">Returned Orders</p>
      <h3 class="text-2xl font-bold text-primary tracking-tight">
        {{ stats.returnedOrders }} ({{ stats.returnRate }})
      </h3>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <div
    class="lg:col-span-2 bg-surface rounded-xl border border-gray-100 shadow-sm overflow-hidden flex flex-col"
  >
    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
      <h3 class="text-lg font-bold text-primary">Recent Orders</h3>
      <a
        class="text-sm font-medium text-primary hover:underline"
        routerLink="/admin/orders"
      >
        View All
      </a>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-50/50">
          <tr>
            <th
              class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Order ID
            </th>
            <th
              class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Customer
            </th>
            <th
              class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Date
            </th>
            <th
              class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Amount
            </th>
            <th
              class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Status
            </th>
          </tr>
        </thead>
        <tbody
          class="divide-y divide-gray-100"
          *ngIf="recentOrders$ | async as orders"
        >
          <tr
            class="hover:bg-gray-50/50 transition-colors"
            *ngFor="let order of orders"
          >
            <td class="px-6 py-4 text-sm font-medium text-primary">
              {{ order.orderNumber }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-600">
              {{ order.customerName }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-500">
              {{ order.orderDate | date: "mediumDate" }}
            </td>
            <td class="px-6 py-4 text-sm font-medium text-primary">
              <app-price-display
                [amount]="order.total"
                size="sm"
              ></app-price-display>
            </td>

            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [ngClass]="statusClass(order.status)"
              >
                {{ order.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div
    class="bg-surface rounded-xl border border-gray-100 shadow-sm flex flex-col"
  >
    <div class="p-6 border-b border-gray-100">
      <h3 class="text-lg font-bold text-primary">Popular Products</h3>
    </div>
    <div
      class="p-6 flex flex-col gap-6"
      *ngIf="popularProducts$ | async as products"
    >
      <div class="flex items-center gap-4" *ngFor="let product of products">
        <div
          class="bg-gray-100 rounded-lg w-12 h-12 bg-cover bg-center shrink-0"
          data-alt="Abstract gradient placeholder for product image"
          [style.background-image]="
            'url(' + imageUrlService.getImageUrl(product.imageUrl) + ')'
          "
        ></div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-semibold text-primary truncate">
            {{ product.name }}
          </p>
          <p class="text-xs text-gray-500">
            {{ product.soldCount }} sold • {{ product.stock }} in stock
          </p>
        </div>

        <div class="text-sm font-bold text-primary">
          <app-price-display
            [amount]="product.price"
            size="sm"
          ></app-price-display>
        </div>
      </div>
      <button
        class="w-full mt-2 py-2 text-sm text-primary font-medium bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
        type="button"
        routerLink="/admin/products"
      >
        View All Products
      </button>
    </div>
  </div>
</div>

<footer class="mt-12 mb-6 text-center" *ngIf="settings$ | async as settings">
  <p class="text-sm text-gray-400">
    © {{ Math.max(2026, date.getFullYear()) }}
    {{ settings.websiteName || "Admin Console" }}. All rights reserved.
  </p>
</footer>

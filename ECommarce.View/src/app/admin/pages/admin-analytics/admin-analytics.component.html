<div class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 scroll-smooth">
  <!-- Section Header -->
  <div>
    <h2 class="text-primary dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-tight">
      Analytics
    </h2>
    <p class="text-gray-500 dark:text-gray-400 text-sm mt-1">
      Performance metrics and insights.
    </p>
  </div>

  <!-- Main Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    
    <!-- Sales Chart Section -->
    <div class="col-span-1 lg:col-span-2 bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
      <div class="flex items-center justify-between mb-6">
        <div>
           <h3 class="text-lg font-bold text-primary dark:text-white">Revenue Overview</h3>
           <p class="text-sm text-gray-500">Total sales over time</p>
        </div>
        <div class="flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1">
          <button 
            *ngFor="let p of periods"
            (click)="onPeriodChange(p)"
            [class.bg-white]="salesPeriod === p"
            [class.dark:bg-gray-700]="salesPeriod === p"
            [class.shadow-sm]="salesPeriod === p"
            class="px-4 py-1.5 rounded-md text-sm font-medium capitalize transition-all"
            [ngClass]="salesPeriod === p ? 'text-primary dark:text-white' : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'"
          >
            {{ p }}
          </button>
        </div>
      </div>
      
      <!-- CSS Bar Chart -->
      <div class="h-64 flex items-end justify-between gap-2 mt-4">
        <div *ngIf="salesData.length === 0" class="w-full h-full flex items-center justify-center text-gray-400 text-sm">
          No sales data for this period.
        </div>
        <div 
          *ngFor="let item of salesData" 
          class="flex-1 flex flex-col items-center gap-2 group relative"
        >
          <!-- Tooltip -->
          <div class="absolute bottom-full mb-2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10 pointer-events-none">
            {{ item.date | date:'mediumDate' }}: <app-price-display [amount]="item.amount"></app-price-display>
          </div>
          
          <div 
            class="w-full bg-primary/80 hover:bg-primary rounded-t-sm transition-all"
            [style.height]="getBarHeight(item.amount)"
          ></div>
          <span class="text-[10px] text-gray-400 hidden sm:block rotate-45 sm:rotate-0 mt-1 origin-left">{{ item.date | date:'MM/dd' }}</span>
        </div>
      </div>
    </div>

    <!-- Top Products -->
    <div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
      <h3 class="text-lg font-bold text-primary dark:text-white mb-6">Top Selling Products</h3>
      <div class="space-y-4">
        <div *ngFor="let product of topProducts; let i = index" class="flex items-center gap-4">
           <span class="text-lg font-bold text-gray-300 w-6">{{ i + 1 }}</span>
           <div 
             class="w-12 h-12 rounded-lg bg-gray-100 bg-cover bg-center border border-gray-200"
             [style.background-image]="'url(' + imageUrlService.getImageUrl(product.imageUrl) + ')'"
           ></div>
           <div class="flex-1 min-w-0">
             <h4 class="font-medium text-primary dark:text-white truncate" [title]="product.name">{{ product.name }}</h4>
             <p class="text-xs text-gray-500">{{ product.soldCount }} sold</p>
           </div>
           <div class="text-right">
             <app-price-display [amount]="product.price" class="font-medium text-sm"></app-price-display>
           </div>
        </div>
         <div *ngIf="topProducts.length === 0" class="text-center text-gray-500 py-8">
          No trending products yet.
        </div>
      </div>
    </div>

    <!-- Order Status Distribution -->
    <div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
      <h3 class="text-lg font-bold text-primary dark:text-white mb-6">Order Status</h3>
      <div class="space-y-4">
        <div *ngFor="let item of statusDistribution">
           <div class="flex justify-between text-sm mb-1">
             <span class="text-gray-600 dark:text-gray-300">{{ item.status }}</span>
             <span class="font-medium text-primary dark:text-white">{{ item.count }}</span>
           </div>
           <div class="w-full bg-gray-100 dark:bg-gray-800 rounded-full h-2 overflow-hidden">
             <div 
               class="h-full rounded-full"
               [ngClass]="{
                 'bg-yellow-500': item.status === 'Processing',
                 'bg-blue-500': item.status === 'Shipped',
                 'bg-green-500': item.status === 'Delivered',
                 'bg-red-500': item.status === 'Cancelled' || item.status === 'Refund',
                 'bg-gray-400': !['Processing','Shipped','Delivered','Cancelled','Refund'].includes(item.status)
               }"
               style="width: 100%" 
             ></div>
             <!-- Note: A real percentage logic would be better here but for plain counts this is a visual block -->
           </div>
        </div>
         <div *ngIf="statusDistribution.length === 0" class="text-center text-gray-500 py-8">
          No orders data.
        </div>
      </div>
    </div>

    <!-- Customer Growth -->
    <div class="col-span-1 lg:col-span-2 bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
      <h3 class="text-lg font-bold text-primary dark:text-white mb-4">Customer Growth (Last 6 Months)</h3>
      <div class="flex items-end justify-between gap-4 h-48 px-4">
         <div *ngIf="customerGrowth.length === 0" class="w-full h-full flex items-center justify-center text-gray-400 text-sm">
          No new customers recently.
        </div>
        <div 
          *ngFor="let item of customerGrowth" 
          class="flex flex-col items-center gap-2 group flex-1"
        >
          <div class="text-sm font-bold text-primary dark:text-white mb-1">{{ item.count }}</div>
          <!-- Using a simple height scale relative to max for this chart would be ideal too, 
               but for MVP just showing bubbles or bars. Let's assume max is around 50 for scale. -->
          <div 
            class="w-full bg-accent/20 border-t-2 border-accent rounded-t-sm transition-all relative"
            style="height: 100px; min-height: 20px"
          >
             <div class="absolute bottom-0 w-full bg-accent/10 hover:bg-accent/30 transition-colors" style="height: 100%"></div>
          </div>
          <span class="text-xs text-gray-500">{{ item.date }}</span>
        </div>
      </div>
    </div>

  </div>
</div>

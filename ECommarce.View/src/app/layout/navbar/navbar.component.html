<!-- Top Utility Bar (Clean Minimalist) -->
<div
  class="bg-white text-slate-500 text-[10px] uppercase tracking-[0.2em] py-2 border-b border-gray-100"
>
  <div class="site-container flex justify-between items-center">
    <div class="flex items-center gap-6">
      <a
        [href]="'mailto:' + (vm$ | async)?.settings?.contactEmail"
        class="hover:text-primary transition-colors"
        >{{
          (vm$ | async)?.settings?.contactEmail || "support@sherashopbd24.com"
        }}</a
      >
    </div>
    <div class="hidden md:flex items-center gap-6">
      <a routerLink="/contact" class="hover:text-primary transition-colors"
        >Contact</a
      >
      <a routerLink="/stores" class="hover:text-primary transition-colors"
        >Store Locations</a
      >
      <span class="text-gray-200">|</span>
      <button class="hover:text-primary transition-colors uppercase">
        English
      </button>
    </div>
  </div>
</div>

<header
  class="fixed z-50 w-full transition-all duration-300 border-b bg-white text-slate-900 border-gray-100"
  [ngClass]="{
    'top-0 shadow-sm py-1':
      isScrolled || isMenuOpen || !(vm$ | async)?.isHomePage,
    'top-[34px] py-3': !isScrolled && !isMenuOpen && (vm$ | async)?.isHomePage,
  }"
>
  <ng-container *ngIf="vm$ | async as vm">
    <div class="site-container">
      <div class="flex items-center justify-between h-16 md:h-18">
        <!-- Left Side: Logo -->
        <div class="flex-shrink-0 flex items-center">
          <a routerLink="/" class="flex items-center group">
            <ng-container *ngIf="vm.settings?.logoUrl; else brandText">
              <img
                [src]="imageUrlService.getImageUrl(vm.settings.logoUrl!)"
                [alt]="vm.settings.websiteName || 'Logo'"
                class="h-6 md:h-8 w-auto object-contain transition-transform duration-300"
              />
            </ng-container>
            <ng-template #brandText>
              <span
                class="font-serif text-2xl tracking-tighter uppercase font-extrabold text-primary"
                >{{ vm.settings.websiteName || "SheraShop" }}</span
              >
            </ng-template>
          </a>
        </div>

        <!-- Center: Nav Links -->
        <nav
          class="hidden lg:flex items-center gap-8 flex-1 justify-center px-10"
        >
          <ng-container *ngFor="let item of vm.menu">
            <div class="group relative py-6">
              <a
                [routerLink]="['/category', item.slug]"
                class="text-[10px] uppercase tracking-[0.25em] font-medium text-slate-700 hover:text-primary transition-colors duration-300 relative after:absolute after:bottom-[-2px] after:left-0 after:w-0 after:h-[1px] after:bg-primary after:transition-all group-hover:after:w-full"
              >
                {{ item.name }}
              </a>

              <!-- Mega Menu Dropdown (Minimalist) -->
              <div
                class="invisible group-hover:visible absolute top-full left-1/2 -translate-x-1/2 w-max min-w-[600px] bg-white border border-gray-100 shadow-2xl p-10 grid grid-cols-4 gap-10 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-y-0 transition-all duration-300 z-50 rounded-b-xl"
              >
                <div
                  *ngFor="let sub of item.subCategories"
                  class="flex flex-col gap-4"
                >
                  <h4
                    class="text-[9px] uppercase tracking-[0.3em] font-bold text-primary mb-2 pb-2 border-b border-gray-50"
                  >
                    {{ sub.name }}
                  </h4>
                  <ul class="flex flex-col gap-2.5">
                    <li *ngFor="let coll of sub.collections">
                      <a
                        [routerLink]="['/collection', coll.slug]"
                        class="text-[11px] text-slate-500 hover:text-primary transition-colors duration-300"
                      >
                        {{ coll.name }}
                      </a>
                    </li>
                    <li class="mt-1">
                      <a
                        [routerLink]="['/subcategory', sub.slug]"
                        class="text-[9px] uppercase tracking-wider font-bold text-accent hover:text-primary transition-colors"
                      >
                        Explore All
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </ng-container>
        </nav>

        <!-- Right Side: Utils & Mobile Toggle -->
        <div class="flex items-center gap-5 md:gap-7 flex-shrink-0">
          <!-- Search -->
          <!-- Search -->
          <div class="relative flex items-center">
            <div
              *ngIf="isSearchOpen"
              class="absolute right-full mr-2 w-48 md:w-64"
            >
              <input
                id="navbar-search-input"
                type="text"
                [(ngModel)]="searchQuery"
                (keyup.enter)="onSearch()"
                placeholder="Search products..."
                class="w-full px-3 py-1.5 text-xs text-slate-700 border border-gray-200 rounded-md focus:outline-none focus:border-primary transition-all"
              />
            </div>
            <button
              class="hover:text-primary transition-colors p-1"
              aria-label="Search"
              (click)="toggleSearch()"
            >
              <lucide-icon
                [img]="isSearchOpen ? icons.X : icons.Search"
                class="w-5 h-5 md:w-6 md:h-6 stroke-[1.5]"
              ></lucide-icon>
            </button>
          </div>

          <!-- Profile -->
          <a
            routerLink="/profile"
            class="hover:text-primary transition-colors p-1"
            aria-label="Profile"
          >
            <lucide-icon
              [img]="icons.User"
              class="w-5 h-5 md:w-6 md:h-6 stroke-[1.5]"
            ></lucide-icon>
          </a>

          <!-- Cart -->
          <a
            routerLink="/cart"
            class="hover:text-primary transition-colors p-1 relative"
            aria-label="Cart"
          >
            <lucide-icon
              [img]="icons.ShoppingBag"
              class="w-5 h-5 md:w-6 md:h-6 stroke-[1.5]"
            ></lucide-icon>
            <span
              *ngIf="vm.cartCount > 0"
              class="absolute -top-1 -right-1 h-3.5 w-3.5 rounded-full bg-primary text-[8px] font-bold text-white flex items-center justify-center"
            >
              {{ vm.cartCount }}
            </span>
          </a>

          <!-- Mobile Menu Toggle -->
          <button
            class="lg:hidden hover:text-primary transition-colors p-1"
            (click)="toggleMenu()"
            [attr.aria-expanded]="isMenuOpen"
          >
            <lucide-icon
              [img]="isMenuOpen ? icons.X : icons.Menu"
              class="w-6 h-6 stroke-[1.5]"
            ></lucide-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation Overlay (Refined) -->
    <div
      *ngIf="isMenuOpen"
      class="lg:hidden fixed inset-0 z-40 bg-white pt-24 px-6 overflow-y-auto"
    >
      <nav class="flex flex-col gap-6 w-full py-10">
        <div *ngFor="let item of vm.menu" class="border-b border-gray-100 pb-4">
          <button
            (click)="item.isOpen = !item.isOpen"
            class="flex justify-between items-center w-full py-2"
          >
            <span
              class="text-sm uppercase tracking-[0.2em] font-semibold text-slate-800"
              >{{ item.name }}</span
            >
            <lucide-icon
              [img]="icons.ChevronDown"
              class="w-5 h-5 opacity-50 transition-transform duration-300"
              [ngClass]="{ 'rotate-180': item.isOpen }"
            ></lucide-icon>
          </button>

          <div *ngIf="item.isOpen" class="flex flex-col gap-4 pl-4 pt-4 pb-2">
            <div
              *ngFor="let sub of item.subCategories"
              class="flex flex-col gap-2"
            >
              <h5
                class="text-[9px] uppercase tracking-widest font-bold text-accent"
              >
                {{ sub.name }}
              </h5>
              <ul class="flex flex-col gap-2">
                <li *ngFor="let coll of sub.collections">
                  <a
                    [routerLink]="['/collection', coll.slug]"
                    (click)="closeMenu()"
                    class="text-xs text-slate-500"
                    >{{ coll.name }}</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="mt-4 flex flex-col gap-4 px-4">
          <a
            class="text-[10px] uppercase tracking-[0.15em] text-slate-400 hover:text-primary transition-colors"
            routerLink="/about"
            (click)="closeMenu()"
            >About Us</a
          >
          <a
            class="text-[10px] uppercase tracking-[0.15em] text-slate-400 hover:text-primary transition-colors"
            routerLink="/contact"
            (click)="closeMenu()"
            >Customer Care</a
          >
        </div>

        <div class="flex flex-col gap-4 mt-10">
          <ng-container *ngIf="vm.user; else loginBtn">
            <a
              *ngIf="vm.user.role === 'admin'"
              class="w-full py-3 bg-slate-100 text-slate-900 border border-slate-200 rounded-lg text-[10px] uppercase tracking-widest font-bold text-center"
              routerLink="/admin/dashboard"
              (click)="closeMenu()"
              >Admin Dashboard</a
            >
            <button
              class="w-full py-3 bg-primary text-white rounded-lg text-[10px] uppercase tracking-widest font-bold"
              (click)="logout(); closeMenu()"
            >
              Sign Out
            </button>
          </ng-container>
          <ng-template #loginBtn>
            <a
              class="w-full py-3 bg-primary text-white rounded-lg text-[10px] uppercase tracking-widest font-bold text-center"
              routerLink="/login"
              (click)="closeMenu()"
              >Sign In</a
            >
          </ng-template>
        </div>
      </nav>
    </div>
  </ng-container>
</header>
